---
editor_options: 
  markdown: 
    wrap: 72
---

# Retrieve the data saved AFTER the profiling practice, this means data already cleaned

```{r}
setwd("~/Documents/UPC/1Q/MultivariateAnalysis_MVVA/Labs/Deliverables/MultivariantAnalysis_IBMDataset/")
load("./Data/df_preprocessed_IBM_Employees.Rdata") 
names(df) 
dim(df)
summary(df)

dcon<-df[!sapply(df, is.factor)]

# 
# CLUSTERING
# 

# HIERARCHICAL CLUSTERING
# Euclidean distance
d<-dist(dcon) 
h1<- hclust(d,method="ward.D")
plot(h1)
```

```{r, echo=FALSE}
# WHERE ARE THER THE LEAPS? WHERE WILL YOU CUT THE DENDOGRAM?, HOW MANY CLASSES WILL YOU OBTAIN?
nc = 5
c1<-cutree(h1,nc)
df$cluster<-c1
dcon$cluster<-as.factor(c1)
nc = 5
c5 <- cutree(h1,nc)

table(c1) 
table(c5) 
table(c1,c5)

cdg <- aggregate(as.data.frame(dcon),list(c1),mean) 
cdg

# LETS SEE THE PARTITION VISUALLY
#ggplot(df, aes(MonthlyIncome, Age, color=cluster, shape=Attrition))+
#   geom_point()

#install.packages("GGally")
library(GGally)

ggp1<-ggpairs(dcon, columns = c(1,7,8), aes(color = cluster, alpha = 0.5))
print(ggp1, progress = F)

ggp2<-ggpairs(dcon, columns = c(10,11,12,13), aes(color = cluster, alpha = 0.5)) 
print(ggp2, progress = F)

ggp3<-ggpairs(dcon, columns = c(14,15,16), aes(color = cluster, alpha = 0.5)) 
print(ggp3, progress = F)


```



```{r}
#move to Gower mixed distance to deal 
#simoultaneously with numerical and qualitative data

library(cluster)

#dissimilarity matrix

df_pro<-subset(df, select = -c(DailyRate,HourlyRate,MonthlyRate,AgeToJubilation,TrainingTimesLastYear,DistanceFromHome))

dissimMatrix <- daisy(df_pro, metric = "gower", stand=TRUE)
distMatrix<-dissimMatrix^2

h1<-hclust(distMatrix,method="ward.D")
plot(h1) 
c2<-cutree(h1,3)
df_pro$clust<-as.factor(c2)
#class sizes table(c2)

#Attrition 
boxplot(df_pro$Attrition~c2)

#MonthlyIncome 
boxplot(df_pro$MonthlyIncome~c2, horizontal=TRUE)


ggpairs(df_pro, columns = c(2,1,3,4), aes(color = clust, alpha = 0.5),progress = FALSE)
ggpairs(df_pro, columns = c(2,5,6,7), aes(color = clust, alpha = 0.5),progress = FALSE)
ggpairs(df_pro, columns = c(2,8,9,10), aes(color = clust, alpha = 0.5),progress = FALSE)
ggpairs(df_pro, columns = c(2,11,12,13), aes(color = clust, alpha = 0.5),progress = FALSE)
ggpairs(df_pro, columns = c(2,14,15,16,17), aes(color = clust, alpha = 0.5),progress = FALSE)
ggpairs(df_pro, columns = c(2,18,19,20,21), aes(color = clust, alpha = 0.5),progress = FALSE)
ggpairs(df_pro, columns = c(2,22,23,24,25), aes(color = clust, alpha = 0.5),progress = FALSE)
ggpairs(df_pro, columns = c(2,26,27,28,29), aes(color = clust, alpha = 0.5),progress = FALSE)
ggpairs(df_pro, columns = c(2,30,31,32), aes(color = clust, alpha = 0.5),progress = FALSE)


ggpairs(df_pro, columns = c(2,4), aes(color = clust, alpha = 0.5),progress = FALSE)

table(df_pro[df_pro$clust==1,]$Attrition)
table(df_pro[df_pro$clust==2,]$Attrition)
table(df_pro[df_pro$clust==3,]$Attrition)

table(df_pro[df_pro$clust==1,]$Department)
table(df_pro[df_pro$clust==2,]$Department)
table(df_pro[df_pro$clust==3,]$Department)


pairs(dcon[,1:7], col=c2)

plot(RatiFin,Estalvi,col=c2,main="Clustering of credit data in 4
classes") legend("topright",levels(as.factor(c2)),pch=1,col=c(1:4),
cex=0.6)

cdg \<- aggregate(as.data.frame(dcon),list(c2),mean) cdg

plot(Edad, Gastos, col= c2) points(cdg[,4],cdg[,5],pch=16,col="orange")
text(cdg[,4],cdg[,5], labels=cdg[,1], pos=2, font=2, cex=0.7,
col="orange")

potencials\<-c(3,4,6,7,10,11) pairs(dcon[,potencials],col=c2)

#Profiling plots
```
